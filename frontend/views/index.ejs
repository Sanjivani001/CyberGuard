<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CyberGuard â€” Scanner</title>

  <style>
    :root{
      --bg:#0f1720; --card:#0b1220; --accent:#1976d2; --muted:#9aa4b2;
      --ok:#4caf50; --warn:#ff9800; --danger:#f44336;
    }
    *{box-sizing:border-box;}
    body{
      font-family:Inter, Arial, sans-serif; 
      margin:0; padding:16px; 
      background:linear-gradient(180deg,#071021 0%, #0f1720 100%); 
      color:#e6eef6; 
      min-height:100vh;
    }
    .wrap{
      max-width:1200px; margin:0 auto; 
      background:rgba(255,255,255,0.02); 
      padding:16px; border-radius:10px; 
      box-shadow:0 6px 30px rgba(2,6,23,0.6);
    }
    h1{margin:0 0 8px; text-align:center; font-size:clamp(18px, 5vw, 28px);}
    form{display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-bottom:16px;}
    input[type=text]{
      padding:10px 12px; flex:1; min-width:250px; max-width:520px; 
      border-radius:6px; 
      border:1px solid rgba(255,255,255,0.06); 
      background:transparent; color:inherit; font-size:14px;
    }
    button{
      padding:10px 14px; border-radius:6px; border:none; 
      background:var(--accent); color:#fff; 
      cursor:pointer; font-size:14px; 
      white-space:nowrap; transition:all 0.2s;
    }
    button:hover{opacity:0.9; transform:scale(1.02);}
    button:active{transform:scale(0.98);}
    .note{color:var(--muted); text-align:center; margin-bottom:12px; font-size:13px;}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); 
      padding:12px; border-radius:8px; margin-bottom:12px;
    }
    .manual{margin-bottom:0;}

    .flex-row{display:flex; gap:16px; margin-bottom:16px; flex-wrap:wrap;}
    .flex-col{flex:1; min-width:280px;}
    h3{margin-top:0; margin-bottom:10px; font-size:16px;}

    table{width:100%; border-collapse:collapse; font-size:13px;}
    th, td{
      padding:8px; border-bottom:1px solid rgba(255,255,255,0.03); 
      text-align:left; vertical-align:middle;
    }
    th{color:var(--muted); font-weight:600; font-size:12px;}
    td{word-break:break-word; overflow-wrap:break-word;}

    .score{
      font-weight:700; padding:4px 8px; border-radius:4px; 
      display:inline-block; font-size:12px;
    }
    .low{background:rgba(76,175,80,0.12); color:var(--ok);}
    .med{background:rgba(255,152,0,0.12); color:var(--warn);}
    .high{background:rgba(244,67,54,0.12); color:var(--danger);}
    .small{font-size:12px; color:var(--muted);}

    #recentList{max-height:400px; overflow-y:auto;}
    #tabsList{max-height:300px; overflow-y:auto;}

    /* Buttons row */
    .btn-row{display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px;}
    .btn-row button{flex:1; min-width:90px; padding:8px 10px; font-size:12px;}

    .status-text{font-size:11px; color:var(--muted); margin-top:4px; font-weight:500;}

    /* Fixing column sizes */
    #recentList table th:nth-child(1){width:35%;}
    #recentList table th:nth-child(2){width:15%;}
    #recentList table th:nth-child(3){width:15%; text-align:center;}
    #recentList table th:nth-child(4){width:35%;}

    #recentList table td:nth-child(4){white-space:nowrap;}

    @media (max-width:768px) {
      body{padding:10px;}
      .wrap{padding:10px;}
      h1{font-size:18px;}
      input[type=text]{font-size:16px;}
      .flex-row{gap:8px;}
      .flex-col{min-width:100%;}
      table{font-size:11px;}
      th, td{padding:6px 4px;}
      button{padding:8px 12px; font-size:12px;}
      .btn-row button{font-size:11px; padding:6px 8px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>ðŸ”’ CyberGuard â€” URL Scanner</h1>
    <p class="note">Automatic background monitoring runs for configured targets. Use the input below to manually check any URL.</p>

    <form id="scanForm" action="/scan" method="POST">
      <input type="text" name="url" id="urlInput" placeholder="Paste a URL to scan (e.g. https://example.com)" required />
      <button type="submit">Check Link</button>
    </form>

    

      <!-- LEFT: Manual Scan Result -->
      <div class="flex-col">
        <h3>Manual Scan Result</h3>
        <% if (typeof manualResult !== 'undefined' && manualResult) { %>
          <div class="card manual">
            <div><strong>URL:</strong> <span style="word-break:break-all;"><%= manualResult.url %></span></div>
            <div style="margin-top:8px;">
              <span class="score <%= manualResult.risk < 30 ? 'low' : (manualResult.risk < 70 ? 'med' : 'high') %>">
                <%= manualResult.risk %>
              </span>
              <span class="small" style="margin-left:8px;">(Fraud Score)</span>
            </div>
            <% if (manualResult.hints) { %>
              <div class="small" style="margin-top:8px;"><strong>Status:</strong> <%= manualResult.hints %></div>
            <% } %>
          </div>
        <% } else { %>
          <div class="card manual">
            <div class="small">Enter a URL above and click "Check Link" to see results here.</div>
          </div>
        <% } %>
      </div>

      <!-- RIGHT: Open Browser Tabs -->
      <div class="flex-col">
        <h3>Open Browser Tabs</h3>
        <div class="btn-row">
          <button id="clearTabsDisplayBtn">Clear Display</button>
        </div>
        <div id="tabsList" class="card">
          <table>
            <thead>
              <tr><th>Title</th><th>URL</th><th style="text-align:center;">Risk</th></tr>
            </thead>
            <tbody id="tabsTbody">
              <tr><td colspan="3" class="small">No open tabs reported yet. Install the extension and click "Scan All Open Tabs".</td></tr>
            </tbody>
          </table>
        </div>
        <div id="tabsStatus" class="status-text">ðŸ”„ Auto-refreshing every 5 seconds</div>
      </div>
    

    <!-- Recent Scans History -->
    <h3 style="margin-top:16px; margin-bottom:10px;">Recent Scans History</h3>

    <div class="btn-row">
      <button id="clearDisplayBtn">Clear Display</button>
    </div>

    <div id="historyStatus" class="status-text" style="margin-bottom:10px;">
      (Clears on-screen only â€” data remains in DB) ðŸ”„ Auto-refreshing every 5 seconds
    </div>

    <div id="recentList" class="card">
      <table>
        <thead>
          <tr>
            <th>URL</th>
            <th>Type</th>
            <th style="text-align:center;">Risk</th>
            <th>Scanned at</th>
          </tr>
        </thead>

        <tbody id="scansTbody">
          <% if (Array.isArray(scans) && scans.length) { %>
            <% scans.forEach(s => { %>
              <tr>
                <td style="word-break:break-word;"><%= s.target || s.url || '' %></td>
                <td class="small"><%= s.type || 'URL' %></td>

                <td style="text-align:center;">
                  <span class="score <%= s.riskScore < 30 ? 'low' : (s.riskScore < 70 ? 'med' : 'high') %>">
                    <%= s.riskScore %>
                  </span>
                </td>

                <td class="small" style="white-space:nowrap;">
                  <%= new Date(s.createdAt || s.updatedAt || Date.now()).toLocaleString() %>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="4" class="small">No scans yet.</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>

  </div>

  <script src="/script.js"></script>
</body>
</html>
