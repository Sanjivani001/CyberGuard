<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CyberGuard â€” Scanner</title>

  <style>
    :root{
      --bg:#0f1720; --card:#0b1220; --accent:#1976d2; --muted:#9aa4b2;
      --ok:#4caf50; --warn:#ff9800; --danger:#f44336;
    }
    body{font-family:Inter, Arial, sans-serif; margin:0; padding:32px; background:linear-gradient(180deg,#071021 0%, #0f1720 100%); color:#e6eef6;}
    .wrap{max-width:980px; margin:0 auto; background:rgba(255,255,255,0.02); padding:20px; border-radius:10px; box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    h1{margin:0 0 12px; text-align:center;}
    form{display:flex; gap:8px; justify-content:center; margin-bottom:18px;}
    input[type=text]{padding:10px 12px; width:520px; border-radius:6px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit;}
    button{padding:10px 14px; border-radius:6px; border:none; background:var(--accent); color:#fff; cursor:pointer;}
    .note{color:var(--muted); text-align:center; margin-bottom:14px;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:8px; margin-bottom:12px;}
    .manual{margin-bottom:12px;}
    table{width:100%; border-collapse:collapse;}
    th, td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,0.03); text-align:left; font-size:14px;}
    th{color:var(--muted); font-weight:600; font-size:13px;}
    .score{font-weight:700; padding:4px 8px; border-radius:6px; display:inline-block;}
    .low{background:rgba(76,175,80,0.12); color:var(--ok);}
    .med{background:rgba(255,152,0,0.12); color:var(--warn);}
    .high{background:rgba(244,67,54,0.12); color:var(--danger);}
    .small{font-size:13px; color:var(--muted);}
    #recentList{max-height:420px; overflow:auto;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸ”’ CyberGuard â€” URL Scanner</h1>
    <p class="note">Automatic background monitoring runs for configured targets. Use the input below to manually check any URL.</p>

    <form id="scanForm" action="/scan" method="POST">
      <input type="text" name="url" id="urlInput" placeholder="Paste a URL to scan (e.g. https://example.com)" required />
      <button type="submit">Check Link</button>
    </form>

    <!-- Side-by-side layout: Manual Scan Result (left) + Open Tabs (right) -->
    <div style="display:flex; gap:20px; margin-bottom:20px;">
      <!-- LEFT: Manual Scan Result -->
      <div style="flex:1; min-width:300px;">
        <h3 style="margin-top:0;">Manual Scan Result</h3>
        <% if (typeof manualResult !== 'undefined' && manualResult) { %>
          <div class="card manual" style="margin-bottom:0;">
            <div><strong>URL:</strong> <%= manualResult.url %></div>
            <div style="margin-top:8px;">
              <span class="score <%= manualResult.risk < 30 ? 'low' : (manualResult.risk < 70 ? 'med' : 'high') %>">
                <%= manualResult.risk %>
              </span>
              <span class="small" style="margin-left:12px;">(Fraud Score)</span>
            </div>
            <% if (manualResult.hints) { %>
              <div class="small" style="margin-top:8px;"><strong>Status:</strong> <%= manualResult.hints %></div>
            <% } %>
          </div>
        <% } else { %>
          <div class="card manual" style="margin-bottom:0;">
            <div class="small" style="color:#9aa4b2;">Enter a URL above and click "Check Link" to see results here.</div>
          </div>
        <% } %>
      </div>

      <!-- RIGHT: Open Browser Tabs -->
      <div style="flex:1; min-width:300px;">
        <h3 style="margin-top:0;">Open Browser Tabs</h3>
        <div style="display:flex; gap:6px; margin-bottom:8px;">
          <button id="refreshTabsDisplayBtn" class="btn" style="padding:8px 12px; font-size:12px;">Refresh Tabs</button>
          <button id="clearTabsDisplayBtn" class="btn" style="padding:8px 12px; font-size:12px; margin-left:4px;">Clear Display</button>
        </div>
        <div id="tabsList" class="card" style="margin-bottom:0;">
          <table style="font-size:13px;">
            <thead><tr><th>Title</th><th>URL</th><th>Risk</th></tr></thead>
            <tbody id="tabsTbody">
              <tr><td colspan="3" class="small">No open tabs reported yet. Install the extension and click "Scan All Open Tabs".</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Full-width: Recent Scans History -->
    <h3 style="margin-top:24px;">Recent Scans History</h3>
    <div style="display:flex; gap:8px; align-items:center; margin-bottom:6px;">
      <div>
        <button id="clearDisplayBtn" class="btn">Clear Display</button>
        <button id="refreshDisplayBtn" class="btn" style="margin-left:6px;">Refresh Display</button>
      </div>
      <div style="font-size:0.9em; color:#bbb; margin-left:8px;">(Clears on-screen only â€” data remains in DB)</div>
    </div>
    <div id="recentList" class="card">
      <table>
        <thead>
          <tr><th>URL</th><th>Risk</th><th class="small">Scanned at</th></tr>
        </thead>
        <tbody id="scansTbody">
          <% if (Array.isArray(scans) && scans.length) { %>
            <% scans.forEach(s => { %>
              <tr>
                <td style="max-width:560px; word-break:break-all;"><%= s.target || s.url || '' %></td>
                <td>
                  <span class="score <%= s.riskScore < 30 ? 'low' : (s.riskScore < 70 ? 'med' : 'high') %>">
                    <%= s.riskScore %>
                  </span>
                </td>
                <td class="small"><%= new Date(s.createdAt || s.updatedAt || Date.now()).toLocaleString() %></td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="3" class="small">No scans yet.</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>

  </div>

  <script src="/script.js"></script>
</body>
</html>
